<!DOCTYPE html>
<html lang="US-EN">
<meta name="theme-color" content="#fffcf9"/>
<head>
    <link rel="manifest" href="manifest.json">

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Private Networking with Docker:  Keeping Private Traffic Private"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@nextwavesllc"/>


    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109147161-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109147161-1');
</script>


  	<meta property="og:title" content="Private Networking with Docker:  Keeping Private Traffic Private &middot; NextWave Solutions" />
  	<meta property="og:site_name" content="NextWave Solutions" />
  	<meta property="og:url" content="https://nextwavesolutions.io/post/containerizeitall/" />

    
        
            <meta property="og:image" content="/images/Love-Coding.png"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2018-01-10T10:54:34-06:00" />

    
    

    <title>Private Networking with Docker:  Keeping Private Traffic Private &middot; NextWave Solutions</title>

    
    <meta name="description" content="Keeping private traffic private In reality, no one needs to be able to see your backend services and databases. Those are strictly for the public services runni" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://nextwavesolutions.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://nextwavesolutions.io/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css"  href="https://nextwavesolutions.io/css/screen.css" />
    <style>
	

  nav.navpage:after {
    content: ""; clear: both; display: block;
  }

nav.navpage  > ul >  li > a  {
    font-weight: bold;
    text-decoration: none;
    font-size: 1.2em;
    font-variant:  small-caps;
}


nav.navpage ul  {
  padding-left: 0px;
  margin-left: 0px;
}
nav.navpage ul ul li {
  display: block;
  margin-left: 30px;
  line-height: 1.2em;
}
nav.navpage ul ul li a {
  text-decoration: none
}
nav.navpage ul ul li a:hover {
  text-decoration: underline;
}
nav.navpage ul ul li:after {
  content: "";
}

nav.navpage ul ul li ul li{
  display: block;
  font-size: smaller;
  margin-left: 30px;
  line-height: 1.1em;
}

nav.navchildren{
  margin-top: 0px;
  background: #efefef;
  background: linear-gradient(top, #efefef 0%, #bbbbbb 100%);
  background: -moz-linear-gradient(top, #efefef 0%, #bbbbbb 100%);
  background: -webkit-linear-gradient(top, #efefef 0%,#bbbbbb 100%);
  box-shadow: 0px 0px 90px rgba(0,0,0,0.15);
  padding: 0 20px;
  border-radius: 10px;
  list-style: none;
  position: relative;
  display: inline-table;
  width: 100%;
}

nav.navchildren li {
  font-size: smaller;
  line-height: 1.1em;
  font-family: helvetica;
   

}
nav.navchildren a {

  line-height: 1.1em;

  text-decoration: none
}
nav.navchildren  a:hover {
  text-decoration: underline;
}
</style>
    

    

    
      
          <link href="https://nextwavesolutions.io/index.xml" rel="alternate" type="application/rss+xml" title="NextWave Solutions" />
      
      
    
    <meta name="generator" content="Hugo 0.30.2" />

    <link rel="canonical" href="https://nextwavesolutions.io/post/containerizeitall/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Justyn Temme"
    },
    "author": {
        "@type": "Person",
        "name": "Justyn Temme",
        
        "url": "https://nextwavesolutions.io",
        "sameAs": [
            
            
             
             
             
             
             
            
        ],
        "description": Open Source Developer
        
    },
    "headline": Private Networking with Docker:  Keeping Private Traffic Private,
    "name": Private Networking with Docker:  Keeping Private Traffic Private,
    "wordCount": 695,
    "timeRequired": "PT4M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url":" https://nextwavesolutions.io/post/containerizeitall/",
    "datePublished": 2018-01-10T10:54Z,
    "dateModified": 2018-01-10T10:54Z,
    
    
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": https://nextwavesolutions.io/post/containerizeitall/
    }
}
    </script>
    


    

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nextwavesolutions.io/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nextwavesolutions.io/#content">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nextwavesolutions.io/post/about/">About Me</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nextwavesolutions.io/post/consulting/">Contracting/Consulting</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nextwavesolutions.io/post/whoami/">Who is NextWave?</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/justyntemme/">Github repos</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="https://nextwavesolutions.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">


<link rel="amphtml" href="https://nextwavesolutions.io/amp/containerizeitall">


<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Private Networking with Docker:  Keeping Private Traffic Private</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2018-01-10T10:54:34-06:00">
            Jan 10, 2018
          </time>
        
         
        </section>
    </header>

    <section class="post-content">
      

<h3 id="keeping-private-traffic-private">Keeping private traffic private</h3>

<p>In reality, no one needs to be able to see your backend services and databases. Those are strictly for the public services running on the same box to access. Unfortunately, too many database containers are exposed and pwned fairly easily due to sub-par security measures. By keeping the non-public containers only available to internal traffic, you reduce your attack service and increase security for all of your users.</p>

<h3 id="a-single-nginx-container">A single Nginx Container</h3>

<h4 id="centralizing-keys">Centralizing keys</h4>

<p>In the land before time&hellip; er, excuse me&hellip;the time before docker containers, all SSL certs would be stored in a centralized server on the bare metal machine. We return to a centralized approach via a ngnix docker container responsible for handling all the connections. This could eventually scale to a load balancer if desired.</p>

<h4 id="nginx-conf">nginx.conf</h4>

<p>One would think that using multiple Docker containers, talking to each other, hidden behind the docker network would be a difficult concept to grasp, and even more difficult to implement. Fortunately for us, it&rsquo;s quite the opposite. Below is my nginx.conf with comments to explain how things work.</p>

<p>These simply server optimizations. These are the same regardless of how many containers you are using.</p>

<pre><code>worker_processes 5;

events {worker_connections 1024; }
http {
sendfile on;
gzip on;
gzip_types text/html text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
</code></pre>

<p>Here is where I define the server name that users will be typing into the address bar. The basic reverse proxy setup in which all traffic is forwarded to the <code>http://gitlab</code> container.</p>

<pre><code>server {
    listen 80;
    server_name gitlabserver.com;
    location / {
        proxy_redirect off;
        
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_set_header        Host              $http_host;
        proxy_set_header        X-Real-IP         $remote_addr;
        proxy_set_header        X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header        X-Frame-Options   SAMEORIGIN;
        proxy_pass http://gitlab/;
    }
}
</code></pre>

<p>This is a basic 301 redirect to force https, nothing fancy here.</p>

<pre><code>server {
    listen 80;

    server_name nextwavesolutions.io;
    return 301 https://$server_name$request_uri;
}
</code></pre>

<p>Here is another example of the benefits of multi-container networking. I have another small web panel for my bitcoin trading clients. All traffic is handled by the nginx container, and there was no need to spin anything new up just to server a new webpage (except the web app docker container of course).</p>

<pre><code>
server { 
    listen 80;
    server_name bitcoin.website.io;
    location / {
        proxy_pass http://justynbitcoin/;
        proxy_redirect off;
    }
}
</code></pre>

<p>Finally, here we have the main site container that stores this very site you are reading the article on. All keys are handled in this config. Notice how the docker container actually listens on port 8080, however, traffic directed to this server is forwarded via nginx.</p>

<pre><code>server {
    listen 443 ssl http2;
    server_name nextwavesolutions.io
    
    ssl on;    
    ssl_certificate         /etc/letsencrypt/archive/www.nextwavesolutions.io/fullchain2.pem;
        ssl_certificate_key     /etc/letsencrypt/archive/www.nextwavesolutions.io/privkey2.pem;

    location / {
        proxy_pass http://nextwave:8080;
        proxy_redirect off;
    }
}
}
</code></pre>

<h3 id="docker-compose">Docker compose</h3>

<p>Docker compose is a great tool for managing multi-container setups. The highlight of this setup is how easy it is to simply call another container. For example, if I have one container <code>reverse proxy</code> and one container <code>web-server</code> I can specify in my nginx.conf to forward all traffic for the server <code>web-server.com</code> to <code>http://web-server/</code> as seen in the engine.conf above. Yes, it&rsquo;s that easy, you simply call the network address, whatever you named the container in your docker-compose file. Here is an example docker-compose file I use in production.</p>

<p>Here the reverse proxy container is defined, as well as the volumes for the SSL certifications. Notice port 80, and 443 are exposed. However, no other container has any ports exposed. This is one of the main benefits of multi-container networking. I only expose what I choose to expose and keep the backend DB&rsquo;s from needing to be seen by the public.</p>

<pre><code>version: '2'
services:
     reverseproxy:
          image: reverseproxy
          ports:
               - &quot;80:80&quot;
               - &quot;443:443&quot;
          restart: always
          volumes:
               - &quot;/etc/letsencrypt/archive/www.nextwavesolutions.io:/etc/letsencrypt/archive/www.nextwavesolutions.io&quot;
          privileged: true
</code></pre>

<p>Here I define my container holding the data for nextwavesolutions.io. As you can see, the containers name is <code>nextwave</code>. Therefore, when calling the container form the nginx.conf for forwarding, you simply call <code>http://nextwave/</code> Multi-container networking made easy.</p>

<pre><code>     nextwave:
          image: nextwave
          restart: always
</code></pre>

<p>The rest of the containers follow the same format as the nextwave container, save some special configuration for gitlab.</p>

<pre><code>     justynbitcoin:
             image: jbitcoin
             restart: always
     gitlab:
             image: gitlab/gitlab-ce:latest
             restart: always
             hostname: 'gitlabsubdomain.com'
             environment:
                     GITLAB_OMNIBUS_CONFIG: |
                             external_url 'http://gitlabsubdomain.com'
             volumes:
                 - &quot;/srv/gitlab/config:/etc/gitlab&quot;
                 - &quot;/srv/gitlab/logs:/var/log/gitlab&quot;
                 - &quot;/srv/gitlab/data:/var/opt/gitlab&quot;
</code></pre>

    </section>


  <footer class="post-footer">


    









<section class="author">
  <h4><a href="https://nextwavesolutions.io/">Justyn Temme</a></h4>
  
  <p>Open Source Developer</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">United States of America</span>
    <span class="author-link icon-link"><a href="https://nextwavesolutions.io">https://nextwavesolutions.io</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Private%20Networking%20with%20Docker%3a%20%20Keeping%20Private%20Traffic%20Private&nbsp;-&nbsp;NextWave%20Solutions&amp;url=https%3a%2f%2fnextwavesolutions.io%2fpost%2fcontainerizeitall%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fnextwavesolutions.io%2fpost%2fcontainerizeitall%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fnextwavesolutions.io%2fpost%2fcontainerizeitall%2f&amp;description=Private%20Networking%20with%20Docker%3a%20%20Keeping%20Private%20Traffic%20Private"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fnextwavesolutions.io%2fpost%2fcontainerizeitall%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    







  </footer>
</article>

</main>


  <aside class="read-next">
  
  
      <a class="read-next-story prev" style="no-cover" href="https://nextwavesolutions.io/post/miner/">
          <section class="post">
              <h2>New Project From NextWave: Tools for Bitcoin investment</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">NextWave Solutions</a> All rights reserved - 2017</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://nextwavesolutions.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://nextwavesolutions.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://nextwavesolutions.io/js/index.js"></script>
    

<script>
    if('serviceWorker' in navigator) {
        navigator.serviceWorker
            .register('/sw.js', { scope: '/' })
            .then(function(registration) {
                console.log('Service Worker Registered');
            });

        navigator.serviceWorker
            .ready
            .then(function(registration) {
                console.log('Service Worker Ready');
            });
    }
</script>
</body>
</html>

